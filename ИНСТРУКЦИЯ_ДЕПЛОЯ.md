# Инструкция по загрузке изменений на сервер

## Что было изменено

1. **newServer/src/index.js** - обновлена логика отправки email:
   - Письма всегда отправляются на `79644228177@mail.ru`
   - Если email вакансии указан, письмо отправляется на оба адреса
   - Убрана обязательная проверка email вакансии

2. **НАСТРОЙКА_ОТПРАВКИ_ОТКЛИКОВ.md** - добавлена документация

## Способ 1: Через SSH (рекомендуется)

### Шаг 1: Подключитесь к серверу

```bash
ssh root@91.229.9.105
# Пароль: Z0ri0zb0XNMQPlt5
```

### Шаг 2: Перейдите в директорию проекта

```bash
cd /opt/uchiteltut
```

### Шаг 3: Скопируйте измененный файл

**Вариант A: Если у вас есть git репозиторий на сервере**

```bash
git pull origin main
# или
git pull origin master
```

**Вариант B: Загрузите файл вручную**

Скопируйте содержимое файла `newServer/src/index.js` из вашего проекта и создайте его на сервере:

```bash
nano newServer/src/index.js
```

Вставьте содержимое файла, сохраните (Ctrl+O, Enter, Ctrl+X).

### Шаг 4: Перезапустите только сервер (без потери данных)

```bash
docker-compose -f docker-compose.prod.yml restart server
```

База данных останется нетронутой, так как она хранится в Docker volume.

### Шаг 5: Проверьте статус

```bash
docker-compose -f docker-compose.prod.yml ps
docker-compose -f docker-compose.prod.yml logs -f server
```

## Способ 2: Через PowerShell скрипт (Windows)

Если у вас установлен PuTTY, запустите:

```powershell
.\upload-and-restart.ps1
```

Или выполните команды вручную:

```powershell
# Копирование файла
& "C:\Program Files\PuTTY\pscp.exe" -P 22 -pw Z0ri0zb0XNMQPlt5 "newServer\src\index.js" "root@91.229.9.105:/opt/uchiteltut/newServer/src/index.js"

# Перезапуск сервера
& "C:\Program Files\PuTTY\plink.exe" -ssh -P 22 -l root -pw Z0ri0zb0XNMQPlt5 -batch 91.229.9.105 "cd /opt/uchiteltut && docker-compose -f docker-compose.prod.yml restart server"
```

## Способ 3: Через SCP (Linux/Mac)

```bash
# Копирование файла
scp newServer/src/index.js root@91.229.9.105:/opt/uchiteltut/newServer/src/index.js

# Перезапуск сервера
ssh root@91.229.9.105 "cd /opt/uchiteltut && docker-compose -f docker-compose.prod.yml restart server"
```

## Проверка работы

После перезапуска:

1. Проверьте логи сервера:
   ```bash
   docker-compose -f docker-compose.prod.yml logs -f server
   ```

2. Проверьте health check:
   ```bash
   curl http://localhost:4000/health
   ```

3. Попробуйте отправить отклик на вакансию через сайт

4. Проверьте почту:
   - На email из вакансии (если указан)
   - На **79644228177@mail.ru** (должен прийти всегда)

## Важно

- ✅ База данных **не будет затронута** - данные сохранятся
- ✅ Перезапускается только контейнер `server`
- ✅ Контейнеры `postgres`, `client`, `nginx` продолжают работать
- ⚠️ Если есть активные пользователи, они могут заметить кратковременную недоступность (1-2 секунды)

## Если что-то пошло не так

1. Проверьте логи:
   ```bash
   docker-compose -f docker-compose.prod.yml logs server
   ```

2. Проверьте статус контейнеров:
   ```bash
   docker-compose -f docker-compose.prod.yml ps
   ```

3. Если нужно откатить изменения:
   ```bash
   cd /opt/uchiteltut
   git checkout newServer/src/index.js
   docker-compose -f docker-compose.prod.yml restart server
   ```

4. Если сервер не запускается:
   ```bash
   docker-compose -f docker-compose.prod.yml up -d server
   ```

